<!DOCTYPE html>
<html lang="pt">
<head>
<meta charset="UTF-8">
<title>Simulador Financeiro - Parceria vCloudPoint | Escola</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
<style>
:root {
  --primary-color: #1d3557;
  --secondary-color: #e63946;
  --accent-color: #457b9d;
  --light-color: #f1faee;
  --dark-color: #1d3557;
  --success-color: #2a9d8f;
  --warning-color: #e9c46a;
  --gray-color: #8d99ae;
  --school-color: #e63946;
  --lmb-color: #1d3557;
  --card-bg: #eef2f7;
  --container-bg: #ffffff;
  --shadow: 0 4px 8px rgba(0,0,0,0.1);
  --border-radius: 12px;
}

* {
  box-sizing: border-box;
  margin: 0;
  padding: 0;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
  color: #333;
  line-height: 1.6;
  padding: 0;
  margin: 0;
}

header {
  background: linear-gradient(120deg, var(--primary-color), var(--accent-color));
  color: white;
  padding: 25px 20px;
  text-align: center;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
  position: relative;
  overflow: hidden;
}

header::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, rgba(255,255,255,0) 70%);
  transform: rotate(30deg);
}

header h1 {
  font-size: 2.2rem;
  margin-bottom: 8px;
  letter-spacing: -0.5px;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

header p {
  font-size: 1.2rem;
  opacity: 0.9;
  font-weight: 300;
}

.container {
  max-width: 1400px;
  margin: 25px auto;
  padding: 0 20px;
}

.section {
  background: var(--container-bg);
  padding: 25px;
  border-radius: var(--border-radius);
  margin-bottom: 25px;
  box-shadow: var(--shadow);
  transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.section:hover {
  transform: translateY(-3px);
  box-shadow: 0 6px 15px rgba(0,0,0,0.12);
}

.section h2 {
  color: var(--accent-color);
  margin-bottom: 20px;
  padding-bottom: 10px;
  border-bottom: 2px solid var(--warning-color);
  font-size: 1.8rem;
  display: flex;
  align-items: center;
}

.section h2::before {
  content: "üìä";
  margin-right: 10px;
  font-size: 1.5em;
}

.cards {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
  gap: 20px;
  margin: 25px 0;
}

.card {
  background: var(--card-bg);
  padding: 25px 15px;
  border-radius: var(--border-radius);
  text-align: center;
  box-shadow: var(--shadow);
  transition: all 0.3s ease;
  border: 1px solid rgba(0, 51, 102, 0.1);
  display: flex;
  flex-direction: column;
  justify-content: center;
}

.card.school {
  background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
  border-top: 5px solid var(--school-color);
}

.card.total {
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  border-top: 5px solid var(--accent-color);
}

.card.lmb {
  background: linear-gradient(135deg, #f5f7fa 0%, #e3e9f2 100%);
  border-top: 5px solid var(--lmb-color);
}

.card.investment {
  background: linear-gradient(135deg, #e8f5e9 0%, #c8e6c9 100%);
  border-top: 5px solid var(--success-color);
}

.card.payback {
  background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
  border-top: 5px solid var(--warning-color);
}

.card:hover {
  transform: translateY(-5px);
  box-shadow: 0 8px 20px rgba(0, 51, 102, 0.15);
}

.card h4 {
  font-size: 1.15rem;
  margin-bottom: 15px;
  font-weight: 700;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 10px;
}

.card h4::before {
  font-size: 1.4rem;
}

.card.school h4 {
  color: var(--school-color);
}

.card.total h4 {
  color: var(--accent-color);
}

.card.lmb h4 {
  color: var(--lmb-color);
}

.card.investment h4 {
  color: var(--success-color);
}

.card.payback h4 {
  color: var(--warning-color);
}

.card h3 {
  font-size: 2.0rem;
  font-weight: 800;
  margin-top: 5px;
  min-height: 48px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.card.school h3 {
  color: var(--school-color);
}

.card.total h3 {
  color: var(--accent-color);
}

.card.lmb h3 {
  color: var(--lmb-color);
}

.card.investment h3 {
  color: var(--success-color);
}

.card.payback h3 {
  color: var(--warning-color);
}

.controls-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 25px;
  margin-top: 15px;
}

.control-group {
  margin-bottom: 15px;
}

label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--accent-color);
  font-size: 1.05rem;
}

input[type="number"], 
input[type="text"] {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid #ddd;
  border-radius: 8px;
  font-size: 16px;
  transition: border-color 0.3s;
  font-weight: 600;
}

input[type="number"]:focus, 
input[type="text"]:focus {
  outline: none;
  border-color: var(--primary-color);
  box-shadow: 0 0 0 3px rgba(0, 51, 102, 0.2);
}

.value-display {
  background: rgba(230, 57, 70, 0.15);
  display: inline-block;
  padding: 3px 12px;
  border-radius: 20px;
  font-weight: bold;
  margin-left: 8px;
  min-width: 50px;
  text-align: center;
  color: var(--school-color);
}

button {
  background: linear-gradient(to right, var(--school-color), #c1121f);
  color: white;
  border: none;
  border-radius: 50px;
  padding: 14px 32px;
  font-size: 1.1rem;
  font-weight: 600;
  cursor: pointer;
  transition: all 0.3s ease;
  box-shadow: 0 4px 10px rgba(230, 57, 70, 0.3);
  display: block;
  margin: 15px auto;
  letter-spacing: 0.5px;
  position: relative;
  overflow: hidden;
}

button:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 15px rgba(230, 57, 70, 0.4);
  background: linear-gradient(to right, #c1121f, #a4161a);
}

button:active {
  transform: translateY(1px);
}

button::after {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: rgba(255, 255, 255, 0.2);
  transform: rotate(30deg);
  transition: all 0.6s;
  opacity: 0;
}

button:hover::after {
  opacity: 1;
  left: 100%;
}

button.calcular {
  background: linear-gradient(to right, var(--accent-color), #2a5c82);
  box-shadow: 0 4px 10px rgba(69, 123, 157, 0.3);
}

button.calcular:hover {
  box-shadow: 0 6px 15px rgba(69, 123, 157, 0.4);
  background: linear-gradient(to right, #2a5c82, #1d3e5a);
}

.chart-container {
  position: relative;
  height: 500px;
  margin-top: 15px;
  background: rgba(255, 255, 255, 0.7);
  border-radius: var(--border-radius);
  padding: 15px;
  box-shadow: var(--shadow);
}

.percentage-display {
  background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
  padding: 25px;
  border-radius: var(--border-radius);
  margin: 25px 0;
  border: 2px solid rgba(230, 57, 70, 0.2);
  position: relative;
  overflow: hidden;
}

.percentage-display::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 6px;
  height: 100%;
  background: var(--school-color);
}

.percentage-title {
  text-align: center;
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--school-color);
  margin-bottom: 20px;
}

.percentage-period {
  display: flex;
  justify-content: space-between;
  padding: 15px;
  border-radius: 10px;
  margin-bottom: 15px;
  background: rgba(255, 255, 255, 0.7);
  box-shadow: 0 2px 6px rgba(0,0,0,0.05);
}

.percentage-period:last-child {
  margin-bottom: 0;
}

.percentage-label {
  font-weight: 700;
  font-size: 1.15rem;
  color: var(--dark-color);
  display: flex;
  align-items: center;
  gap: 10px;
}

.percentage-label::before {
  font-size: 1.6rem;
}

.period-1 .percentage-label::before { content: "üéì"; }
.period-2 .percentage-label::before { content: "üèÜ"; }

.percentage-values {
  display: flex;
  flex-direction: column;
  align-items: flex-end;
  gap: 8px;
  font-weight: 700;
  font-size: 1.1rem;
}

.percentage-lmb {
  color: var(--lmb-color);
}

.percentage-school {
  color: var(--school-color);
  font-size: 1.25rem;
}

.projection-section {
  background: linear-gradient(135deg, #e63946 0%, #d62828 100%);
  color: white;
  padding: 30px;
  border-radius: var(--border-radius);
  text-align: center;
  margin: 30px 0;
  box-shadow: 0 6px 15px rgba(0,0,0,0.15);
  display: none;
}

.projection-section.active {
  display: block;
  animation: fadeIn 0.8s ease-out;
}

.projection-section h3 {
  font-size: 1.8rem;
  margin-bottom: 15px;
  display: flex;
  justify-content: center;
  align-items: center;
  gap: 15px;
}

.projection-section h3::before {
  content: "üí∞";
  font-size: 2.2rem;
}

.projection-total {
  font-size: 3.2rem;
  font-weight: 800;
  margin: 15px 0;
  text-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.projection-detail {
  font-size: 1.2rem;
  opacity: 0.95;
  max-width: 700px;
  margin: 0 auto;
  line-height: 1.6;
}

.footer-note {
  text-align: center;
  margin-top: 25px;
  padding: 25px;
  background: var(--card-bg);
  border-radius: var(--border-radius);
  font-size: 0.95rem;
  color: var(--dark-color);
  line-height: 1.6;
  box-shadow: var(--shadow);
}

.highlight {
  background-color: #fff9e6;
  padding: 3px 8px;
  border-radius: 5px;
  font-weight: 700;
}

.school-highlight {
  background-color: rgba(230, 57, 70, 0.15);
  color: var(--school-color);
  padding: 2px 8px;
  border-radius: 5px;
  font-weight: 700;
}

.disclaimer {
  font-size: 0.88rem;
  color: var(--gray-color);
  margin-top: 10px;
  font-style: italic;
  text-align: center;
}

.school-name-display {
  font-size: 2.2rem;
  font-weight: 800;
  color: var(--school-color);
  text-align: center;
  margin: 20px 0;
  padding: 15px;
  background: linear-gradient(135deg, #fff5f5 0%, #ffebee 100%);
  border-radius: var(--border-radius);
  border: 2px solid rgba(230, 57, 70, 0.3);
  display: none;
}

.school-name-display.active {
  display: block;
  animation: fadeIn 0.8s ease-out;
}

.results-section {
  display: none;
}

.results-section.active {
  display: block;
  animation: fadeIn 0.8s ease-out;
}

.capex-section {
  background: linear-gradient(135deg, #e3f2fd 0%, #bbdefb 100%);
  padding: 25px;
  border-radius: var(--border-radius);
  margin: 25px 0;
  border: 2px solid rgba(69, 123, 157, 0.3);
  position: relative;
  overflow: hidden;
}

.capex-section::before {
  content: "";
  position: absolute;
  top: 0;
  left: 0;
  width: 6px;
  height: 100%;
  background: var(--accent-color);
}

.capex-title {
  text-align: center;
  font-size: 1.4rem;
  font-weight: 700;
  color: var(--accent-color);
  margin-bottom: 20px;
}

@media (max-width: 768px) {
  .cards {
    grid-template-columns: 1fr;
  }
  
  .controls-grid {
    grid-template-columns: 1fr;
  }
  
  header h1 {
    font-size: 1.8rem;
  }
  
  header p {
    font-size: 1rem;
  }
  
  .section {
    padding: 20px;
  }
  
  .card h3 {
    font-size: 1.7rem;
  }
  
  .projection-total {
    font-size: 2.4rem;
  }
  
  .percentage-values {
    align-items: flex-start;
  }
  
  button {
    width: 90%;
    padding: 12px;
    font-size: 1rem;
  }
  
  .chart-container {
    height: 350px;
  }
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(10px); }
  to { opacity: 1; transform: translateY(0); }
}

.card, .section {
  animation: fadeIn 0.5s ease-out forwards;
}

.card:nth-child(1) { animation-delay: 0.1s; }
.card:nth-child(2) { animation-delay: 0.2s; }
.card:nth-child(3) { animation-delay: 0.3s; }
</style>
</head>
<body>

<header>
  <h1>Simulador Financeiro - Parceria vCloudPoint</h1>
  <p>An√°lise de Investimento e Retorno | Angola</p>
</header>

<div class="container" id="relatorio">

<div class="section">
  <h2>Informa√ß√µes da Escola</h2>
  
  <div class="controls-grid">
    <div class="control-group">
      <label for="nomeEscola">Nome da Escola:</label>
      <input type="text" id="nomeEscola" placeholder="Digite o nome da escola" value="Escola Exemplo">
      <div class="disclaimer">Informe o nome completo da sua institui√ß√£o de ensino</div>
    </div>
    
    <div class="control-group">
      <label for="alunos">N√∫mero de Alunos:</label>
      <input type="number" min="100" max="3000" value="500" id="alunos" step="1">
      <div class="disclaimer">Total de alunos que utilizar√£o a solu√ß√£o vCloudPoint</div>
    </div>
    
    <div class="control-group">
      <label for="valorMensal">Valor Mensal por Aluno (KZS):</label>
      <input type="number" min="1000" max="20000" value="5000" id="valorMensal" step="500">
      <div class="disclaimer">Valor cobrado por aluno por m√™s para utiliza√ß√£o da solu√ß√£o</div>
    </div>
  </div>
</div>

<div class="capex-section">
  <h3 class="capex-title">Investimento Inicial (CAPEX)</h3>
  
  <div class="controls-grid">
    <div class="control-group">
      <label for="capex">Valor do CAPEX (KZS):</label>
      <input type="number" min="5000000" max="100000000" value="15000000" id="capex" step="1000000">
      <div class="disclaimer">Investimento inicial em infraestrutura e equipamentos vCloudPoint</div>
    </div>
    
    <div class="control-group">
      <label for="mesesLetivos">Meses Letivos por Ano:</label>
      <input type="number" min="6" max="12" value="9" id="mesesLetivos" step="1">
      <div class="disclaimer">N√∫mero de meses com atividade letiva no ano</div>
    </div>
  </div>
</div>

<button class="calcular" onclick="calcular()">‚úÖ Calcular Proje√ß√µes Financeiras</button>

<div class="school-name-display" id="nomeEscolaDisplay">
  Escola Exemplo
</div>

<div class="percentage-display">
  <h3 class="percentage-title">Distribui√ß√£o de Receita ao Longo do Projeto</h3>
  
  <div class="percentage-period period-1">
    <div class="percentage-label">Anos 1 a 4 (Parceria Inicial)</div>
    <div class="percentage-values">
      <span class="percentage-lmb">LMB: 60%</span>
      <span class="percentage-school">Escola: <strong>40%</strong></span>
    </div>
  </div>
  
  <div class="percentage-period period-2">
    <div class="percentage-label">Anos 5 a 7 (Parceria Consolidada)</div>
    <div class="percentage-values">
      <span class="percentage-lmb">LMB: 50%</span>
      <span class="percentage-school">Escola: <strong>50%</strong></span>
    </div>
  </div>
</div>

<div class="results-section" id="resultsSection">
  
  <div class="cards">
    <div class="card total">
      <h4>üí∞ Receita Total Anual (Ano 1)</h4>
      <h3 id="receitaTotal">22.500.000 KZS</h3>
    </div>
    
    <div class="card school">
      <h4>üè´ Receita da Escola (Ano 1)</h4>
      <h3 id="receitaEscola">9.000.000 KZS</h3>
    </div>
    
    <div class="card lmb">
      <h4>ü§ù Receita LMB (Ano 1)</h4>
      <h3 id="receitaLMB">13.500.000 KZS</h3>
    </div>
    
    <div class="card investment">
      <h4>üìà ROI Total (7 anos)</h4>
      <h3 id="roiTotal">383%</h3>
    </div>
    
    <div class="card payback">
      <h4>‚è±Ô∏è Payback (Recupera√ß√£o)</h4>
      <h3 id="paybackTempo">1.1 anos</h3>
    </div>
    
    <div class="card school">
      <h4>üìä Receita Acumulada Escola</h4>
      <h3 id="receitaAcumuladaEscola">72.450.000 KZS</h3>
    </div>
    
    <div class="card lmb">
      <h4>üí∞ Receita Acumulada LMB</h4>
      <h3 id="receitaAcumuladaLMB">108.675.000 KZS</h3>
    </div>
    
    <div class="card investment">
      <h4>üíµ Lucro L√≠quido LMB</h4>
      <h3 id="lucroLiquidoLMB">93.675.000 KZS</h3>
    </div>
  </div>

  <div class="projection-section" id="projectionSection">
    <h3>Proje√ß√£o de Retorno para <span id="nomeEscolaTitulo">Sua Escola</span></h3>
    <div class="projection-total" id="projecaoTotal">72.450.000 KZS</div>
    <div class="projection-detail">
      Em 7 anos de parceria com a vCloudPoint, <span id="nomeEscolaDestaque">sua escola</span> gerar√° <span class="school-highlight">mais de 72 milh√µes de KZS</span> 
      em receita, sem investimento inicial. A LMB recuperar√° seu investimento em apenas <span class="highlight" id="paybackDestaque">1.1 anos</span>.
    </div>
  </div>

  <div class="section">
    <h2>Evolu√ß√£o Financeira (7 Anos)</h2>
    <div class="chart-container">
      <canvas id="receitaChart"></canvas>
    </div>
    <div class="disclaimer">
      <strong>Nota:</strong> Gr√°fico mostra receita anual da Escola e LMB. Linha tracejada representa o CAPEX inicial.
    </div>
  </div>

  <div class="section">
    <h2>An√°lise de Retorno sobre Investimento (LMB)</h2>
    <div class="chart-container">
      <canvas id="roiChart"></canvas>
    </div>
    <div class="disclaimer">
      <strong>Payback:</strong> Tempo necess√°rio para recuperar o investimento inicial de <span id="capexDisplay">15.000.000 KZS</span>
    </div>
  </div>

  <button onclick="exportarPDF()">üì• Exportar Relat√≥rio Completo</button>
</div>

<div class="footer-note">
  <p><strong>Como Funciona a Parceria:</strong></p>
  <p>
    ‚Ä¢ A <span class="highlight">LMB investe todo o CAPEX</span> (infraestrutura e equipamentos vCloudPoint)<br>
    ‚Ä¢ Sua escola disponibiliza o espa√ßo f√≠sico e os alunos<br>
    ‚Ä¢ A receita √© gerada com base no <span class="highlight">valor mensal por aluno</span> durante os meses letivos<br>
    ‚Ä¢ Sua escola recebe <span class="school-highlight">40% da receita nos primeiros 4 anos</span> e <span class="school-highlight">50% nos anos 5 a 7</span><br>
    ‚Ä¢ <span class="school-highlight">Sem risco financeiro</span> para a escola ‚Äì o investimento √© 100% da LMB
  </p>
  <p style="margin-top: 15px; font-weight: 600; font-style: italic;">
    <strong>Indicadores de Investimento:</strong><br>
    ‚Ä¢ <span class="highlight">Payback:</span> Tempo para recuperar o CAPEX inicial<br>
    ‚Ä¢ <span class="highlight">ROI (Return on Investment):</span> Retorno total sobre o investimento em 7 anos<br>
    Este simulador demonstra o potencial financeiro para ambas as partes.
  </p>
</div>

</div>

<script>
let chartReceita = null;
let chartROI = null;
const alunosEl = document.getElementById("alunos");
const nomeEscolaEl = document.getElementById("nomeEscola");
const valorMensalEl = document.getElementById("valorMensal");
const capexEl = document.getElementById("capex");
const mesesLetivosEl = document.getElementById("mesesLetivos");

const receitaTotalEl = document.getElementById("receitaTotal");
const receitaEscolaEl = document.getElementById("receitaEscola");
const receitaLMBEl = document.getElementById("receitaLMB");
const roiTotalEl = document.getElementById("roiTotal");
const paybackTempoEl = document.getElementById("paybackTempo");
const receitaAcumuladaEscolaEl = document.getElementById("receitaAcumuladaEscola");
const receitaAcumuladaLMBEl = document.getElementById("receitaAcumuladaLMB");
const lucroLiquidoLMBEl = document.getElementById("lucroLiquidoLMB");
const projecaoTotalEl = document.getElementById("projecaoTotal");
const capexDisplayEl = document.getElementById("capexDisplay");
const paybackDestaqueEl = document.getElementById("paybackDestaque");

// Elementos para exibi√ß√£o do nome da escola
const nomeEscolaDisplayEl = document.getElementById("nomeEscolaDisplay");
const nomeEscolaTituloEl = document.getElementById("nomeEscolaTitulo");
const nomeEscolaDestaqueEl = document.getElementById("nomeEscolaDestaque");

// Elementos de se√ß√£o de resultados
const resultsSectionEl = document.getElementById("resultsSection");
const projectionSectionEl = document.getElementById("projectionSection");

// Fun√ß√£o para obter a porcentagem da Escola por ano
function getPercentagemEscola(ano) {
  return ano <= 4 ? 0.40 : 0.50;
}

function atualizarNomeEscola() {
  const nomeEscola = nomeEscolaEl.value.trim() || "Sua Escola";
  nomeEscolaDisplayEl.textContent = nomeEscola;
  nomeEscolaTituloEl.textContent = nomeEscola;
  nomeEscolaDestaqueEl.textContent = nomeEscola.toLowerCase();
}

function calcular() {
  // Obter valores dos inputs
  const alunos = parseFloat(alunosEl.value) || 0;
  const valorMensal = parseFloat(valorMensalEl.value) || 0;
  const capex = parseFloat(capexEl.value) || 0;
  const mesesLetivos = parseFloat(mesesLetivosEl.value) || 9;
  const nomeEscola = nomeEscolaEl.value.trim() || "Sua Escola";
  
  // Valida√ß√£o dos inputs
  if (alunos < 100) {
    alert("Por favor, insira um n√∫mero m√≠nimo de 100 alunos.");
    alunosEl.focus();
    return;
  }
  
  if (valorMensal < 1000) {
    alert("Por favor, insira um valor m√≠nimo de 1.000 KZS por aluno.");
    valorMensalEl.focus();
    return;
  }
  
  if (capex < 5000000) {
    alert("Por favor, insira um valor m√≠nimo de 5.000.000 KZS para o CAPEX.");
    capexEl.focus();
    return;
  }
  
  // Atualizar nome da escola
  atualizarNomeEscola();
  
  // C√°lculos do primeiro ano
  const receitaTotal = alunos * valorMensal * mesesLetivos;
  
  // Ano 1: 40% para Escola
  const percEscolaAno1 = 0.40;
  const receitaEscolaAno1 = receitaTotal * percEscolaAno1;
  const receitaLMBAno1 = receitaTotal * (1 - percEscolaAno1);
  
  // Atualizar elementos da UI com valores do primeiro ano
  receitaTotalEl.innerText = formatarMoeda(receitaTotal);
  receitaEscolaEl.innerText = formatarMoeda(receitaEscolaAno1);
  receitaLMBEl.innerText = formatarMoeda(receitaLMBAno1);
  capexDisplayEl.innerText = formatarMoeda(capex);
  
  // Construir dados para os gr√°ficos (7 anos)
  let receitaAcumuladaEscola = 0;
  let receitaAcumuladaLMB = 0;
  let receitaTotal7Anos = 0;
  
  // Arrays para armazenar os valores anuais
  const receitasAnuaisEscola = [];
  const receitasAnuaisLMB = [];
  const receitasAnuaisTotais = [];
  const receitaAcumuladaLMBArray = [];
  const labels = ['Ano 1', 'Ano 2', 'Ano 3', 'Ano 4', 'Ano 5', 'Ano 6', 'Ano 7'];
  
  for (let i = 1; i <= 7; i++) {
    const percEscola = getPercentagemEscola(i);
    const percLMB = 1 - percEscola;
    
    // Calcular receita do ano
    const receitaAno = alunos * valorMensal * mesesLetivos;
    const receitaEscola = receitaAno * percEscola;
    const receitaLMB = receitaAno * percLMB;
    
    receitasAnuaisEscola.push(Math.round(receitaEscola));
    receitasAnuaisLMB.push(Math.round(receitaLMB));
    receitasAnuaisTotais.push(Math.round(receitaAno));
    
    receitaAcumuladaEscola += receitaEscola;
    receitaAcumuladaLMB += receitaLMB;
    receitaTotal7Anos += receitaAno;
    
    receitaAcumuladaLMBArray.push(Math.round(receitaAcumuladaLMB));
  }
  
  // C√°lculo do Payback (tempo para recuperar o CAPEX)
  let paybackAnos = 0;
  let receitaAcumuladaPayback = 0;
  let anoPayback = 0;
  let mesesPayback = 0;
  
  for (let i = 0; i < 7; i++) {
    if (receitaAcumuladaPayback < capex) {
      receitaAcumuladaPayback += receitasAnuaisLMB[i];
      paybackAnos++;
    } else {
      break;
    }
  }
  
  // C√°lculo mais preciso do payback
  if (paybackAnos > 0) {
    const receitaAntes = receitaAcumuladaPayback - receitasAnuaisLMB[paybackAnos - 1];
    const receitaNecessaria = capex - receitaAntes;
    const fracaoAno = receitaNecessaria / receitasAnuaisLMB[paybackAnos - 1];
    paybackAnos = (paybackAnos - 1) + fracaoAno;
    anoPayback = Math.floor(paybackAnos);
    mesesPayback = Math.round((paybackAnos - anoPayback) * 12);
  }
  
  // C√°lculo do ROI (Retorno sobre Investimento)
  const lucroLiquidoLMB = receitaAcumuladaLMB - capex;
  const roiPercentual = ((lucroLiquidoLMB / capex) * 100).toFixed(0);
  
  // Formatar payback para exibi√ß√£o
  let paybackFormatado;
  if (paybackAnos < 1) {
    paybackFormatado = mesesPayback + " meses";
  } else if (mesesPayback === 0) {
    paybackFormatado = anoPayback + " ano(s)";
  } else {
    paybackFormatado = anoPayback + " ano(s) e " + mesesPayback + " m√™s(es)";
  }
  
  // Atualizar elementos
  receitaAcumuladaEscolaEl.innerText = formatarMoeda(receitaAcumuladaEscola);
  receitaAcumuladaLMBEl.innerText = formatarMoeda(receitaAcumuladaLMB);
  lucroLiquidoLMBEl.innerText = formatarMoeda(lucroLiquidoLMB);
  roiTotalEl.innerText = "+" + roiPercentual + "%";
  paybackTempoEl.innerText = paybackAnos.toFixed(1) + " anos";
  paybackDestaqueEl.innerText = paybackAnos.toFixed(1) + " anos";
  projecaoTotalEl.innerText = formatarMoeda(receitaAcumuladaEscola);
  
  // Atualizar gr√°fico de receita
  atualizarGraficoReceita(labels, receitasAnuaisEscola, receitasAnuaisLMB, receitasAnuaisTotais, capex);
  
  // Atualizar gr√°fico de ROI
  atualizarGraficoROI(labels, receitaAcumuladaLMBArray, capex);
  
  // Mostrar se√ß√µes de resultados
  resultsSectionEl.classList.add('active');
  projectionSectionEl.classList.add('active');
  nomeEscolaDisplayEl.classList.add('active');
  
  // Rolar para os resultados
  setTimeout(() => {
    resultsSectionEl.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }, 300);
}

function atualizarGraficoReceita(labels, receitasEscola, receitasLMB, receitasTotais, capex) {
  const ctx = document.getElementById('receitaChart').getContext('2d');
  
  if (chartReceita) {
    chartReceita.destroy();
  }
  
  chartReceita = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Receita da Escola (KZS)',
          data: receitasEscola,
          backgroundColor: 'rgba(230, 57, 70, 0.8)',
          borderColor: 'rgba(230, 57, 70, 1)',
          borderWidth: 2,
          borderRadius: 6,
          hoverBackgroundColor: 'rgba(230, 57, 70, 0.95)'
        },
        {
          label: 'Receita da LMB (KZS)',
          data: receitasLMB,
          backgroundColor: 'rgba(29, 53, 87, 0.8)',
          borderColor: 'rgba(29, 53, 87, 1)',
          borderWidth: 2,
          borderRadius: 6,
          hoverBackgroundColor: 'rgba(29, 53, 87, 0.95)'
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: true,
          text: 'Evolu√ß√£o da Receita Anual da Escola e LMB (7 Anos)',
          font: {
            size: 16,
            weight: 'bold'
          },
          padding: {
            top: 10,
            bottom: 20
          }
        },
        tooltip: {
          mode: 'index',
          intersect: false,
          callbacks: {
            label: function(context) {
              const ano = context.dataIndex + 1;
              const percEscola = getPercentagemEscola(ano) * 100;
              const percLMB = 100 - percEscola;
              const receitaTotalAno = receitasTotais[context.dataIndex];
              
              if (context.dataset.label.includes('Escola')) {
                return [
                  `${context.dataset.label}: ${formatarMoeda(context.parsed.y)}`,
                  `Receita total do ano ${ano}: ${formatarMoeda(receitaTotalAno)}`,
                  `Participa√ß√£o: ${percEscola}%`
                ];
              } else {
                return [
                  `${context.dataset.label}: ${formatarMoeda(context.parsed.y)}`,
                  `Receita total do ano ${ano}: ${formatarMoeda(receitaTotalAno)}`,
                  `Participa√ß√£o: ${percLMB}%`
                ];
              }
            }
          }
        },
        legend: {
          position: 'top',
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Receita Anual (KZS)'
          },
          ticks: {
            callback: function(value) {
              return formatarMoeda(value);
            }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Anos de Parceria'
          },
          grid: {
            display: false
          }
        }
      },
      interaction: {
        mode: 'index',
        intersect: false
      },
      animation: {
        duration: 1500,
        easing: 'easeOutQuart'
      }
    }
  });
}

function atualizarGraficoROI(labels, receitaAcumuladaLMB, capex) {
  const ctx = document.getElementById('roiChart').getContext('2d');
  
  if (chartROI) {
    chartROI.destroy();
  }
  
  // Criar array para o CAPEX (linha horizontal)
  const capexArray = Array(7).fill(capex);
  
  chartROI = new Chart(ctx, {
    type: 'line',
    data: {
      labels: labels,
      datasets: [
        {
          label: 'Receita Acumulada LMB (KZS)',
          data: receitaAcumuladaLMB,
          borderColor: 'rgba(29, 53, 87, 1)',
          backgroundColor: 'rgba(29, 53, 87, 0.1)',
          borderWidth: 4,
          fill: true,
          tension: 0.3,
          pointRadius: 6,
          pointBackgroundColor: 'rgba(29, 53, 87, 1)',
          pointHoverRadius: 8
        },
        {
          label: 'CAPEX Inicial (KZS)',
          data: capexArray,
          borderColor: 'rgba(230, 57, 70, 1)',
          backgroundColor: 'transparent',
          borderWidth: 3,
          borderDash: [10, 5],
          fill: false,
          tension: 0,
          pointRadius: 0,
          pointHoverRadius: 0
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        title: {
          display: true,
          text: 'Recupera√ß√£o do Investimento (Payback Analysis)',
          font: {
            size: 16,
            weight: 'bold'
          },
          padding: {
            top: 10,
            bottom: 20
          }
        },
        tooltip: {
          mode: 'index',
          intersect: false
        },
        legend: {
          position: 'top',
        }
      },
      scales: {
        y: {
          beginAtZero: true,
          title: {
            display: true,
            text: 'Valor (KZS)'
          },
          ticks: {
            callback: function(value) {
              return formatarMoeda(value);
            }
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.05)'
          }
        },
        x: {
          title: {
            display: true,
            text: 'Anos de Parceria'
          },
          grid: {
            color: 'rgba(0, 0, 0, 0.03)'
          }
        }
      },
      interaction: {
        mode: 'index',
        intersect: false
      },
      animation: {
        duration: 1500,
        easing: 'easeOutQuart'
      }
    }
  });
}

function formatarMoeda(valor) {
  return valor.toLocaleString("pt-PT") + " KZS";
}

function exportarPDF() {
  const element = document.getElementById('relatorio');
  const opt = {
    margin: 10,
    filename: 'Relatorio-Parceria-vCloudPoint-' + (nomeEscolaEl.value.trim() || 'Escola') + '.pdf',
    image: { type: 'jpeg', quality: 0.98 },
    html2canvas: { scale: 2, useCORS: true },
    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
  };

  const btn = event.target;
  const originalText = btn.innerHTML;
  btn.innerHTML = 'üñ®Ô∏è Gerando Relat√≥rio...';
  btn.disabled = true;
  
  setTimeout(() => {
    html2pdf().set(opt).from(element).save().then(() => {
      btn.innerHTML = originalText;
      btn.disabled = false;
      alert('Relat√≥rio gerado com sucesso!\n\nEste documento demonstra o potencial financeiro da parceria vCloudPoint para sua escola.');
    }).catch((error) => {
      console.error('Erro ao gerar PDF:', error);
      btn.innerHTML = originalText;
      btn.disabled = false;
      alert('Ocorreu um erro ao gerar o PDF. Por favor, tente novamente.');
    });
  }, 500);
}

// Inicializar
atualizarNomeEscola();
</script>
</body>
</html>